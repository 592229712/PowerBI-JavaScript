language: node_js
node_js:
    - '4.4'
before_script:
    - npm install
script: gulp test
after_success:
    # CREATE GIT TAG
    - git config --global user.email "builds@travis-ci.com"
    - git config --global user.name "Travis CI"
    - export GIT_TAG=build-$TRAVIS_BRANCH-$(date -u "+%Y-%m-%d")-$TRAVIS_BUILD_NUMBER
    - echo -n $GIT_TAG > public/version
    - git commit -m "Set build VERSION number" public/version
    - git tag $GIT_TAG -a -m "Generated tag from TravisCI build $TRAVIS_BUILD_NUMBER"
    - git push --quiet https://$GITHUBKEY@github.com/Microsoft/PowerBI-JavaScript $GIT_TAG > /dev/null 2>&1
deploy:
    provider: releases
    skip_cleanup: true
    all_branches: true
    api_key:
        secure: TW876+3HZz9VaBrWB1UAA0lGIqXHRntG8fWxOG4DrKcYMhF7NJlMUWaJsZhB64Ulfbe6jj5/NJ6NKJ++dqYFZhq/8WD0RK+B22gjcuLOJ4dovefQ8i3xGE3qmkCHBTC/94aDiWXDIEY3/1yq7I473aOKgTQWZxmYpkbekIQZnHy70P4oEGB2cwdtKKFdlk+BtwPvZsRUhXHizCmR/kEBXUvPe5SOkl62jdHX0BFO3/0Em8AVMXmThG7PhX0aySQ6Lovn/RRwLWUjPc02OiudpG7pGkG3eMVvtw6KnGGLURwWMRNH7Mnc7fXxGGNrFGfruLs5JoIFhDV1HTyWUlCMJL8yNlsQiPXyhCsbBPCeGfX1VYTIO2o+vZg8UEyLIrtMGVMyMzpE9y264lZYVJC0tDOa6Vuob7WxutoIEPwKXVDmaI3pvGMVJRaK9Exit7iqUp7SGbI5czA0hX6ypo+0szpRh8V2X+OXpqmeCaJiCUlnLmEtp7tJrRidoinA0l0z3jJbpI8VCwKut4u6i0m/yywCM3R320JJbjeK3nKt7yK9gjfIPSFkX76/NCGMX+aUTSqX5Tq9zKssOpv81chmoFmwu8bSXKClC2x5FaO5w+kxKv3G8jpeMBVHqhUXpwgVGIGTmFXZPcspYU8cLv63UzeoCyUSRe0+UASK6wCEtYA=
    file: 
        - 'dist/powerbi.js'
        - 'dist/powerbi.d.ts'
        - 'dist/powerbi.js.map'
        - 'dist/powerbi.min.js'
branches:
    except:
        - /^build-[0-9a-z\-]*/